#!/usr/bin/env node
import fs from 'node:fs';
import path from 'node:path';

function readJsonl(name) {
  const p = path.join(process.cwd(), 'fixtures', 'codex', 'jsonl', name);
  return fs.readFileSync(p, 'utf-8').trimEnd() + '\n';
}

// Minimal stub for integration tests.
// It ignores most flags and emits deterministic JSONL.
const argv = process.argv.slice(2);

const isExec = argv[0] === 'exec';
const isResume = isExec && argv[1] === 'resume';

if (!isExec) {
  console.error('fake codex: expected "exec"');
  process.exit(2);
}

if (isResume) {
  if (argv.includes('--sandbox') || argv.includes('-C') || argv.includes('--cd')) {
    console.error('fake codex: resume does not accept --sandbox/-C');
    process.exit(2);
  }
  process.stdout.write(readJsonl('resume.jsonl'));
} else {
  process.stdout.write(readJsonl('new_thread.jsonl'));
}
